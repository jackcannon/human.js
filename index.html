<!doctype html>
<html>
  <head>
    <title>Human.js</title>
    <link rel="icon" href="img/logo-smaller.png" type="image/png">
    <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/main.css">
  </head>
  <body>
    <div id="sidebar">
      <div id="sidebarContents">
        <input type="button" value="<<" id="hideSidebar"></input><br/>
        <h1>Human JS</h1>
        <h2>High level functions</h2>
        <div class="sidebarSection">
          <h3>Human.prototype.say(string)</h3>
          <ul><li><span class="bold">string</span> - What the human should say. Required.</li></ul>
          <p>Allows the Human to speak.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.wave()</h3>
          <p>The human waves it's "main" hand, in a welcoming manner.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.dance(type)</h3>
          <ul><li><span class="bold">type</span> - The type of dance to perform. Optional.</li></ul>
          <p>The human dances one of the three dances: robot, sway and travolta.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.robot()</h3>
          <p>The human dances the robot.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.sway(times)</h3>
          <ul><li><span class="bold">times</span> - The number of times to sway. Optional.</li></ul>
          <p>The human sways side to side.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.travolta(times)</h3>
          <ul><li><span class="bold">times</span> - The number of times to point up. Optional.</li></ul>
          <p>The human mimics John Travolta in Saturday Night Fever.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.clap(times)</h3>
          <ul><li><span class="bold">times</span> - The number of times to clap. Optional.</li></ul>
          <p>The human claps his/her hands together.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.tapFoot(times, side)</h3>
          <ul>
            <li><span class="bold">times</span> - The number of times to clap. Optional.</li>
            <li><span class="bold">side</span> - Which side to tap foot on ('left' or 'right'). Optional.</li>
          </ul>
          <p>The human taps his/her foot on the ground.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.handsOnHips(numOfSeconds)</h3>
          <ul><li><span class="bold">numOfSeconds</span> - The number of seconds to have hands of hips. Optional.</li></ul>
          <p>The human places both hands on his/her hips.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.scratchHead(side)</h3>
          <ul><li><span class="bold">side</span> - Which side to scratch head on ('left' or 'right'). Optional.</li></ul>
          <p>The human scratches the top of his/her head.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.prototype.punchAir()</h3>
          <p>The human punches the air in celebration.</p>
        </div>
        <h2>Properties and Support functions</h2>
        <div class="sidebarSection">
          <h3>Human.x</h3>
          <p>The x value of the Human's position.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.y</h3>
          <p>The y value of the Human's position.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.gender</h3>
          <p>The gender of the Human. 'male' or 'female'.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.orientation</h3>
          <p>The side preference of the Human. 'left' or 'right'.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.universe</h3>
          <p>The universe in which the Human operates. Optional.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.name</h3>
          <p>The name of the Human.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.saying</h3>
          <p>What the human is currently saying.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.behaviour</h3>
          <p>An object of various lower-priority settings.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.points</h3>
          <p>The details of the various points on the Human's skeleton.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.defaults</h3>
          <p>The default details of the various points on the Human's skeleton.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.getCoor(point, addPosition)</h3>
          <ul>
            <li><span class="bold">point</span> - The name of the point on the skeleton.</li>
            <li><span class="bold">addPosition</span> - Boolean on whether to add the Human's position to the coordinate.</li>
          </ul>
          <p>Returns a coordinate for the given point.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.eventListeners</h3>
          <p>The current event listeners.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.doing</h3>
          <p>Array of what Human is doing.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.fireEvent(event, value, sf)</h3>
          <ul>
            <li><span class="bold">event</span> - What the human is doing. e.g. 'wave', 'dance', etc.</li>
            <li><span class="bold">value</span> - Any value to pass on to listener. Optional.</li>
            <li><span class="bold">sf</span> - Whether this is start of event, or the end (i.e. finish).</li>
          </ul>
          <p>Iterates through all Humans in universe, calling any eventListeners that meet the given requirements.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.addListener(event, func)</h3>
          <ul>
            <li><span class="bold">event</span> - What to listen for. e.g. 'wave', 'dance', etc.</li>
            <li><span class="bold">func</span> - Function to perform on event</li>
          </ul>
          <p>Adds the given details to human's current event listeners. Listeners listen to other humans in universe.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.removeListener(event)</h3>
          <ul><li><span class="bold">event</span> - What event to remove listener for.</li></ul>
          <p>Removes the given details from human's current event listeners. Listeners listen to other humans in universe.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.startDoing(act, value)</h3>
          <ul>
            <li><span class="bold">act</span> - What the human is doing. e.g. 'wave', 'dance', etc.</li>
            <li><span class="bold">value</span> - Some value to pass on to eventListeners. Optional.</li>
          </ul>
          <p>Adds act to Human's doing list, and fires relevant listeners.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.finishDoing(act, value)</h3>
          <ul>
            <li><span class="bold">act</span> - What the human is doing. e.g. 'wave', 'dance', etc.</li>
            <li><span class="bold">value</span> - Some value to pass on to eventListeners. Optional.</li>
          </ul>
          <p>Removes act from Human's doing list, and fires relevant listeners.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.isDoing(act)</h3>
          <ul><li><span class="bold">act</span> - What the human is supposedly doing. e.g. 'wave', 'dance', etc.</li></ul>
          <p>Returns whether or not Human is doing given act.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.perform(tasks, done)</h3>
          <ul>
            <li><span class="bold">tasks</span> - Array of tasks to do.[ { timer: 10, func: function(cb) {} } ]</li>
            <li><span class="bold">done</span> - Function to call when completed. Optional.</li>
          </ul>
          <p>A way of timing steps between several actions. Each object in the tasks array should have a timer value (the number of milliseconds since last step to wait before doing this step) and func (what to do during that step). See examples of this in the code for high-level functions.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.tween(point, newValue, time, cb)</h3>
          <ul>
            <li><span class="bold">point</span> - The name of the point on the skeleton.</li>
            <li><span class="bold">newValue</span> - What to change the value to.</li>
            <li><span class="bold">time</span> - How long to take in milliseconds. Optional.</li>
            <li><span class="bold">cb</span> - Function to call when completed. Optional</li>
          </ul>
          <p>Slowly moves the point to the new value over the given time. This means that movement is fluid looking rather than robotic and jagged.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.multiTween(arr, clbck)</h3>
          <ul>
            <li><span class="bold">arr</span> - Arr of objects containing information on what to change, and how long.</li>
            <li><span class="bold">clbck</span> - Function to call when completed. Optional</li>
          </ul>
          <p>Tweens multiple points at once. See examples of this in the code for high-level functions.</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.pointToCoor(pointName, targetCoor, timer, intersectPoint)</h3>
          <ul>
            <li><span class="bold">pointName</span> - The name of the point on the skeleton.</li>
            <li><span class="bold">targetCoor</span> - Coordinate of where to place point.</li>
            <li><span class="bold">timer</span> - How long to take if output is being used for MultiTween. Optional.</li>
            <li><span class="bold">intersectPoint</span> - Which intersect point to use. Optional</li>
          </ul>
          <p>Moves given point to given coordinate. Moves 2 points to get position right (e.g. if moving rightWrist, rightElbow will also move).</p>
        </div>
        <div class="sidebarSection">
          <h3>Human.reset()</h3>
          <p>Sets points values back to default.</p>
        </div>
      </div>
    </div>
    <div id="main">
      <canvas id="display"></canvas>
      <div id="controls">
        <textarea id="input"></textarea>
        <div id="buttons">
          <input type="button" value="Go" id="go"></input>
          <input type="button" value="Clear" id="clear"></input>
        </div>
      </div>
    </div>

    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="js/async.js"></script>
    <script src="http://cloud.github.com/downloads/processing-js/processing-js/processing-1.4.1.min.js"></script>
    <script src="js/human.js"></script>

    <script>
      var sidebar = {
        show: function (e) {
          $('#main').removeClass('full');
          $('#sidebar').removeClass('hide');
          $('#sidebarContents').show();
          setTimeout(function () {
            $('#hideSidebar').click(function (e) { console.log(e); sidebar.hide(); });
          }, 500);
        },
        hide: function () {
          $('#main').addClass('full');
          $('#sidebar').addClass('hide');
          setTimeout(function () {
            $('#sidebar.hide').click(function (e) {
              if ($(e.target).attr('id') !== 'hideSidebar') {
                sidebar.show();
              }
            });
            $('#sidebarContents').hide();
          }, 500);
        }
      }
      $('#hideSidebar').click(function () { sidebar.hide(); });

      setTimeout(function () {
        sidebar.hide();
      }, 1000);

      var box = [];

      var John = new Human({
        name: 'John',
        gender: 'male',
        x: -100,
        y: 0
      });
      var Jane = new Human({
        name: 'Jane',
        gender: 'female',
        orientation: 'left',
        x: 100,
        y: 0
      });

      var colors = {
        male: {
          light: [150, 150, 255],
          dark: [100, 100, 255]
        },
        female: {
          light: [255, 175, 175],
          dark: [255, 125, 125]
        }
      };

      function doProcessing(processing) {

        processing.setup = function() {
          font = processing.createFont('Ubuntu');
          processing.textFont(font, 18);
          processing.frameRate(12);

          processing.size($('#display').width(), $('#display').height());
          processing.background(255);
        };

        processing.draw = function () {
          processing.size($('#display').width(), $('#display').height());
          processing.background(255);

          var centreX = processing.width / 2 - 20;
          var centreY = processing.height / 2 + 75;

          function grid(spacing, color) { //color is grayscale between 0 and 255 only
            if(!spacing) var spacing = 50;
            if(!color) {
              processing.fill(200 , 200 , 200);
              processing.stroke(200 , 200 , 200);
            } else {
              processing.fill(color , color , color);
              processing.stroke(color , color , color);
            }
            processing.strokeWeight(1);
            var pW = processing.width;
            var pH = processing.height;
            for(var hor = 1; hor < Math.ceil(pW / spacing); hor++) {
              processing.line((hor * spacing), 0, (hor * spacing), pH);
            }
            for(var ver = 1; ver < Math.ceil(pH / spacing); ver++) {
              processing.line(0, (ver * spacing), pW, (ver * spacing));
            }
          };

          function setColor(gender, light) {
            processing.fill(colors[gender][light][0], colors[gender][light][1] , colors[gender][light][2]);
            processing.stroke(colors[gender][light][0], colors[gender][light][1] , colors[gender][light][2]);
          };

          function drawFloor() {
            processing.fill(230 , 230 , 230);
            processing.stroke(230 , 230 , 230);
            processing.strokeWeight(3);
            processing.line(0, centreY + 60, processing.width, centreY + 60);
          };

          function crosshair() {
            processing.fill(128 , 128 , 128);
            processing.stroke(128 , 128 , 128);
            processing.strokeWeight(1);
            var shift = -2;
            processing.line(centreX + shift, centreY - 10 + shift, centreX + shift, centreY + 10 + shift);
            processing.line(centreX - 10 + shift, centreY + shift, centreX + 10 + shift, centreY + shift);
          };

          function drawPoint(x, y, gender) { //dont apply centreX/centreY, do apply obj.x/obj.y beforehand
            setColor(gender, 'light');
            processing.strokeWeight(1);

            var pointX = centreX + x - 2;
            var pointY = centreY + y - 2;

            processing.ellipse(pointX, pointY, 4, 4);
          };

          function drawLine(x1, y1, x2, y2, gender) {
            setColor(gender, 'dark');
            processing.strokeWeight(2);
            processing.line(centreX + x1 - 2, centreY + y1 - 2, centreX + x2 - 2, centreY + y2 - 2);
          };

          function text(x, y, text, gender, type) { // type == 'header' || 'speech'
            setColor(gender, 'dark');
            if(type == 'header') {
              processing.textFont(font, 14);
            } else if (type == 'speech') {
              processing.textFont(font, 11);
            }

            processing.textAlign('CENTER', 'CENTER');
            var textWidth = processing.textWidth(text);
            processing.text( text , centreX + x - (textWidth / 2) - 2 , centreY + y - 2 );
          };

          // grid(50, 240);
          // crosshair();
          drawFloor();

          for (var obj in box) {
            for(var p in box[obj].points) {
              var point = box[obj].points[p];
              var bp = box[obj].getCoor(p);
              for(var co in point.connects) {
                var ip = box[obj].getCoor(point.connects[co]);
                drawLine(bp.x, bp.y, ip.x, ip.y, box[obj].gender);
              }
            }

            for(var p in box[obj].points) {
              var ip = box[obj].getCoor(p);
              drawPoint(ip.x, ip.y, box[obj].gender);
            }

            //do text
            var crown = box[obj].getCoor('crown');
            text(crown.x, crown.y - 30, box[obj].name, box[obj].gender, 'header');
            text(crown.x, crown.y - 15, box[obj].saying, box[obj].gender, 'speech');
          }
        }
      }


      var canvas = document.getElementById("display");
      var processingInstance = new Processing(canvas, doProcessing);

      var execute = function () {
        $('#go').attr('disabled', 'disabled');
        setTimeout(function () {
          $('#go').attr('disabled', false);
        }, 1000);

        return (box.length > 0) ? function() {
          var stuff = eval($('#input').val());
          // if(stuff) console.log(stuff);
        }.bind(box[0])() : null;
      };

      $('#go').click(execute);

      $('#clear').click(function () {
        $('#clear').attr('disabled', 'disabled');
        setTimeout(function () {
          $('#clear').attr('disabled', false);
        }, 500);

        $('#input').val('');
      })

      // $("#input, #display").hover(
      //   function () {
      //     $('#input').css({"border-top": "2px dashed rgb(65, 65, 255)"});
      //   },
      //   function () {
      //     $('#input').css({"border-top": "2px dashed rgb(100, 100, 255)"});
      //   }
      // );

      $('#input').keydown(function (e) {
        if (e.keyCode == 13 && e.shiftKey) {
          execute();
          e.preventDefault();
        }
        if (e.keyCode == 9) {
          // $('#input').val($('#input').val() + '  ');
          // console.log($('#input').caret().start);
          e.preventDefault();
        }
      });


      var putHumansInBox = function() {
        for(var v in window) {
          if(window[v] instanceof Human && ($.inArray(window[v], box) === -1)) {
            window[v].universe = box;
            box.push(window[v]);
          }
        }
      };
      putHumansInBox();
      var boxLoop = setInterval(putHumansInBox, 500);

    </script>

  </body>
</html>